<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home  |  Funkoshop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="stylesheet" href="../CSS/reset.css">
    <link rel="stylesheet" href="../CSS/index.css">
    <link rel="stylesheet" href="../CSS/carrito-de-compras.css">
    <link rel="stylesheet" href="../CSS/footer.css"> 
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  </head>
<body>    
  <%- include('../views/partials/header')%>

  <main>
      <div class="container" style="display: flex; flex-direction: column; align-items: center; width: 100%; ">

        <!-- Primera sección -->
        <div class="section" style="margin-bottom: 10px;">
          <div class="summary-box" style="padding: 10px; width: 100%;">
            <!-- Sección de elementos del carrito -->
            <div class="section">
              <div class="row" style="background-color: #f0f0f0; border-radius: 4px; font-size: 2.2em;">
                <div class="column">Detalle del Producto</div>
                <div class="column">Cantidad</div>
                <div class="column">Total</div>
              </div>
        
              <% productosInfo.forEach(info => { %>
                <% if (info.producto && info.producto.id_producto !== null) { %>
                  <div class="row" style="background-color: #f0f0f0; border-radius: 4px; font-size: 1.6em;">
        
                    <div class="column">
                      <% const rutaCompletaFront = info.producto.imagen_front; %>
                      <% const rutaRelativaFront = rutaCompletaFront.replace('public', ''); %>
                      <% console.log(rutaRelativaFront) %>
                      <img src="<%= rutaRelativaFront %>" alt="Miniatura" style="width: 100px; height: auto;">
                      <%= info.producto.nombre %>
                    </div>
                    <div class="column">
                      <!-- Agrega botones + y - -->
                      <button class="quantity-button" onclick="updateQuantity('<%= info.elemento.id_producto %>', 'increment')">+</button>
                      <span class="quantity"><%= info.elemento.cantidad %></span>
                      <button class="quantity-button" onclick="updateQuantity('<%= info.elemento.id_producto %>', 'decrement')">-</button>
                    </div>
        
                    <div class="column">$<%= info.elemento.cantidad * info.elemento.precio_unitario %></div>
                  </div>
                <% } %>
              <% }); %>
            </div>
          </div>
        </div>
    
        <!-- Segunda sección -->
      <div class="section" style="display: flex; flex-direction: column;"></div>
      <div class="summary-title" style="margin: margin-bottom; align-self: flex-end;">RESUMEN</div>
        <div class="section" style="display: flex; flex-direction: column;  ">
          <div class="summary-box" style="background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; padding: 10px; text-align: left;">
              <div class="summary-list">
                  <div class="summary-column" style="text-align: left;">Cantidad de elementos</div>
                  <div class="summary-column" style="text-align: right;"><%= cantidadTotal %></div>
                  <div class="summary-line2" style="text-align: left;"></div>
                  <div class="summary-column" style="text-align: left;">Subtotal</div>
                  <div class="summary-column" style="text-align: right;">$<%= subTotal %></div>
                  <div class="summary-line2" style="text-align: left;"></div>
                  <div class="summary-column" style="text-align: left;">ENVÍO</div>
                  <div class="summary-column" style="text-align: right;">$<%= costoEnvio %></div>
                  <div class="summary-line" style="text-align: left;"></div>
                  <div class="summary-column" style="text-align: left;">TOTAL</div>
                  <div class="summary-column" style="text-align: right;">$<%= totalPagar %></div>
              </div>
              <button class="summary-button" style="margin-top: 10px;">IR A PAGAR</button>
          </div>
        </div>
      </div> 
        

      </div>
    </main>

    <%- include('../views/partials/footer')%>

    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function (e) {
        // Función para actualizar la cantidad al hacer clic en los botones + o -
        function updateQuantity(productId, action) {
          // Realiza la lógica para incrementar o decrementar la cantidad según la acción
          // Puedes utilizar AJAX o fetch para enviar la actualización al servidor si es necesario
    
          // Por ahora, solo actualizamos la cantidad en el cliente
          const quantityElement = document.querySelector(`[data-product-id="${productId}"] .column .quantity`);
          let currentQuantity = parseInt(quantityElement.textContent);
    
          if (action === 'increment') {
            currentQuantity++;
          } else if (action === 'decrement' && currentQuantity > 1) {
            currentQuantity--;
          }
    
          quantityElement.textContent = currentQuantity;
        }
    
        // Asigna la función updateQuantity al ámbito global para que sea accesible desde el evento onclick
        window.updateQuantity = updateQuantity;
      });
    </script>
    
  </body>
</html>
